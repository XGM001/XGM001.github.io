<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.1.0">


  <link rel="apple-touch-icon" sizes="180x180" href="https://s2.loli.net/2022/05/05/gBXlLUE2i9YxOuT.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://s2.loli.net/2022/05/05/gBXlLUE2i9YxOuT.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://s2.loli.net/2022/05/05/gBXlLUE2i9YxOuT.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" integrity="sha256-DfWjNxDkM94fVBWx1H5BMMp0Zq7luBlV8QRcSES7s+0=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/themes/blue/pace-theme-minimal.css">
  <script src="https://cdn.jsdelivr.net/npm/pace-js@1.2.4/pace.min.js" integrity="sha256-gqd7YTjg/BtfqWSwsJOvndl0Bxc8gFImLEkXQT8+qj0=" crossorigin="anonymous"></script>

<script class="next-config" data-name="main" type="application/json">{"hostname":"goupos.top","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.11.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="GoupOS线程管理">
<meta property="og:type" content="article">
<meta property="og:title" content="GoupOS线程管理">
<meta property="og:url" content="https://goupos.top/2022/05/07/GoupOS%E6%96%87%E7%AB%A0/GoupOS%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86/index.html">
<meta property="og:site_name" content="个人博客">
<meta property="og:description" content="GoupOS线程管理">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://s2.loli.net/2022/05/07/rqz19bRSAUg4oFi.png">
<meta property="og:image" content="https://s2.loli.net/2022/05/07/FtHJYEGkWmQdlbe.png">
<meta property="og:image" content="https://s2.loli.net/2022/05/07/5QsbiJzohYL2UKX.png">
<meta property="og:image" content="https://s2.loli.net/2022/05/07/87AzsDPXCj1v6FK.png">
<meta property="og:image" content="https://s2.loli.net/2022/05/07/QmjcC3a9yXdZM5K.png">
<meta property="og:image" content="https://s2.loli.net/2022/05/07/RSVq3NLfI9dB6iT.png">
<meta property="og:image" content="https://s2.loli.net/2022/05/07/RSVq3NLfI9dB6iT.png">
<meta property="og:image" content="https://s2.loli.net/2022/05/07/t42OabQ1oUshM7T.png">
<meta property="article:published_time" content="2022-05-06T18:50:01.000Z">
<meta property="article:modified_time" content="2022-05-07T06:36:56.510Z">
<meta property="article:author" content="xgm">
<meta property="article:tag" content="GoupOS嵌入式实时操作系统">
<meta property="article:tag" content="RTOS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://s2.loli.net/2022/05/07/rqz19bRSAUg4oFi.png">


<link rel="canonical" href="https://goupos.top/2022/05/07/GoupOS%E6%96%87%E7%AB%A0/GoupOS%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://goupos.top/2022/05/07/GoupOS%E6%96%87%E7%AB%A0/GoupOS%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86/","path":"2022/05/07/GoupOS文章/GoupOS线程管理/","title":"GoupOS线程管理"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>GoupOS线程管理 | 个人博客</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="个人博客" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">个人博客</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-%E9%9C%80%E8%A6%81%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86%E7%9A%84%E5%8E%9F%E5%9B%A0"><span class="nav-text">1. 需要线程管理的原因</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86%E7%9A%84%E5%8A%9F%E8%83%BD%E7%89%B9%E7%82%B9"><span class="nav-text">2. 线程管理的功能特点</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E7%BA%BF%E7%A8%8B%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6"><span class="nav-text">3. 线程工作机制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%B1%9E%E6%80%A7"><span class="nav-text">1. 线程的属性</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%BA%BF%E7%A8%8B%E6%A0%88"><span class="nav-text">1. 线程栈</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81"><span class="nav-text">2. 线程状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E7%BA%BF%E7%A8%8B%E4%BC%98%E5%85%88%E7%BA%A7"><span class="nav-text">3. 线程优先级</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E6%97%B6%E9%97%B4%E7%89%87"><span class="nav-text">4. 时间片</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E7%BA%BF%E7%A8%8B%E5%85%A5%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="nav-text">5. 线程入口函数</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E7%BA%BF%E7%A8%8B%E9%94%99%E8%AF%AF%E7%A0%81"><span class="nav-text">6. 线程错误码</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%BA%BF%E7%A8%8B%E7%8A%B6%E6%80%81%E5%88%87%E6%8D%A2"><span class="nav-text">2. 线程状态切换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%B3%BB%E7%BB%9F%E7%BA%BF%E7%A8%8B"><span class="nav-text">3. 系统线程</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%A9%BA%E9%97%B2%E7%BA%BF%E7%A8%8B"><span class="nav-text">1. 空闲线程</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-%E7%BA%BF%E7%A8%8B%E7%9A%84%E7%AE%A1%E7%90%86%E6%96%B9%E5%BC%8F"><span class="nav-text">4. 线程的管理方式</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA%E5%92%8C%E5%88%A0%E9%99%A4%E7%BA%BF%E7%A8%8B"><span class="nav-text">1. 创建和删除线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E8%8E%B7%E5%8F%96%E7%BA%BF%E7%A8%8B%E4%BF%A1%E6%81%AF"><span class="nav-text">2. 获取线程信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BA%BF%E7%A8%8B%E7%9D%A1%E7%9C%A0"><span class="nav-text">3. 线程睡眠</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-%E6%8C%82%E8%B5%B7%E5%92%8C%E6%81%A2%E5%A4%8D%E7%BA%BF%E7%A8%8B"><span class="nav-text">4. 挂起和恢复线程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-%E8%AE%BE%E7%BD%AE%E5%92%8C%E5%88%A0%E9%99%A4%E7%A9%BA%E9%97%B2%E9%92%A9%E5%AD%90"><span class="nav-text">5. 设置和删除空闲钩子</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-%E8%AE%BE%E7%BD%AE%E8%B0%83%E5%BA%A6%E9%94%81%E9%92%A9%E5%AD%90"><span class="nav-text">6. 设置调度锁钩子</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E7%BA%BF%E7%A8%8B%E5%BA%94%E7%94%A8%E7%A4%BA%E4%BE%8B"><span class="nav-text">5. 线程应用示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E7%A4%BA%E4%BE%8B"><span class="nav-text">1. 创建线程示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-%E7%BA%BF%E7%A8%8B%E6%97%B6%E9%97%B4%E7%89%87%E8%BD%AE%E8%BD%AC%E8%B0%83%E5%BA%A6%E7%A4%BA%E4%BE%8B"><span class="nav-text">2. 线程时间片轮转调度示例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-%E7%BA%BF%E7%A8%8B%E8%B0%83%E5%BA%A6%E5%99%A8%E9%92%A9%E5%AD%90%E7%A4%BA%E4%BE%8B"><span class="nav-text">3. 线程调度器钩子示例</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="xgm"
      src="https://img-qn-2.51miz.com/preview/element/00/01/25/80/E-1258046-80796AAA.gif">
  <p class="site-author-name" itemprop="name">xgm</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">17</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">17</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/XGM001" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;XGM001" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/xgm-embedded-os/GoupOS" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;xgm-embedded-os&#x2F;GoupOS" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>Gitee</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:xgmcreate@foxmail.com" title="E-Mail0 → mailto:xgmcreate@foxmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail0</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:xgmcreate@189.cn" title="E-Mail1 → mailto:xgmcreate@189.cn" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail1</a>
      </span>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      技术帮助友情链接与网站导航
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://home.goupos.top/" title="https:&#x2F;&#x2F;home.goupos.top&#x2F;" rel="noopener" target="_blank">网站导航</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="http://blog.bubuzi.top/" title="http:&#x2F;&#x2F;blog.bubuzi.top&#x2F;" rel="noopener" target="_blank">布布子Blog</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://home.bubuzi.top/" title="https:&#x2F;&#x2F;home.bubuzi.top&#x2F;" rel="noopener" target="_blank">布布子导航</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://home.bubuzi.top/" title="https:&#x2F;&#x2F;home.bubuzi.top&#x2F;" rel="noopener" target="_blank">导航对齐</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://goupos.top/2022/05/07/GoupOS%E6%96%87%E7%AB%A0/GoupOS%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="https://img-qn-2.51miz.com/preview/element/00/01/25/80/E-1258046-80796AAA.gif">
      <meta itemprop="name" content="xgm">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="个人博客">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="GoupOS线程管理 | 个人博客">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          GoupOS线程管理
        </h1>

        <div class="post-meta-container">
          
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2022-05-07 02:50:01 / 修改时间：14:36:56" itemprop="dateCreated datePublished" datetime="2022-05-07T02:50:01+08:00">2022-05-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/GoupOS/" itemprop="url" rel="index"><span itemprop="name">GoupOS</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/GoupOS/GoupOS%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" itemprop="url" rel="index"><span itemprop="name">GoupOS设计与实现</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Changyan：</span>
    
    <a title="GoupOS线程管理" href="/2022/05/07/GoupOS%E6%96%87%E7%AB%A0/GoupOS%E7%BA%BF%E7%A8%8B%E7%AE%A1%E7%90%86/#SOHUCS" itemprop="discussionUrl">
      <span id="sourceId::b6619f584e9bca9eee9c4595a8097542" class="cy_cmt_count" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>10 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <blockquote>
<p>GoupOS线程管理</p>
</blockquote>
<span id="more"></span>

<h2 id="1-需要线程管理的原因"><a href="#1-需要线程管理的原因" class="headerlink" title="1. 需要线程管理的原因"></a>1. 需要线程管理的原因</h2><p>在日常生活中，我们要解决个大问题，般会将它分解成多个简单的、容易解决的小问题，小问题逐个被解决，大问题也就随之解决了。在多线程操作系统中，同样需要开发人员把个复杂的应用分解成多个小的、可调度的、序列化的程序单元，当合理地划分任务并正确地执行时，这种设计就能够让系统满足实时系统的性能及时间的要求。例如让嵌入式系统执行这样的任务，即系统通过传感器采集数据，并通过显示屏将数据显示出来，在多线程实时系统中，可以将该任务分解成两个子任务，如下图所示，任务l不间断地读取传感器数据，并将数据写到共享内存中，任务2周期性地从共享内存中读取数据，并 将传感器数据输出到显示屏上。<br><img data-src="https://s2.loli.net/2022/05/07/rqz19bRSAUg4oFi.png" alt="传感器数据接收任务与显示任务的切换执行.png"><br>在GoupOS中，与上述子任务对应的程序实体就是线程。线程是实现任务的载体，是GoupOS中最基本的调度单位，它描述了个任务执行的运行环境，也描述了该任务所处的优先等级。重要的任务可设置相对较高的优先级，非重要的任务可以设置较低的优先级，不同的任务还可以设置相同的优先级，轮流运行。<br>当线程运行时，它会认为自己是以独占CPU的方式在运行，线程执行时的运行环境称为上下文。</p>
<h2 id="2-线程管理的功能特点"><a href="#2-线程管理的功能特点" class="headerlink" title="2. 线程管理的功能特点"></a>2. 线程管理的功能特点</h2><p>GoupOS线程管理的主要功能是对线程进行管理和调度。系统中共存在两类线程，分别是系统线程和用户线程，系统线程是由GoupOS内核创建的线程，用户线程是由应用程序创建的线程。这两类线程都会从内核对象容器中分配线程对象，当线程被删除时，线程对象也会被从对象容器中删除。每个线程都有重要的属性，如线程控制块、线程栈、入口函数等。<br>GoupOS的线程调度器是抢占式的，其主要工作就是从就绪线程列表中查找最高优先级线程，保证优先级最高的线程能够被运行，优先级最高的任务一旦就绪，总能得到CPU一的使用权。<br>当有高优先级线程满足条件后，低优先级线程运行权就被剥夺了，或者说让出了，高优先级的线程会立刻得到CPU的使用权。<br>如果是中断服务程序使一个高优先级的线程满足运行条件，则中断完成时，被中断的线程挂起，优先级高的线程开始运行。<br>当调度器调度线程切换时，先将当前线程上下文保存起来，当再切回到这个线程时，线程调度器将恢复该线程的上下文信息。</p>
<h2 id="3-线程工作机制"><a href="#3-线程工作机制" class="headerlink" title="3. 线程工作机制"></a>3. 线程工作机制</h2><p>在GoupOS中，线程控制块由结构体struct _tTask表示。线程控制块是操作系统用于管理线程的数据结构，它会存放线程的一些信息，例如优先级、线程名称、线程状态等，包含线程与线程之间连接用的链表结构、线程等待事件集合等，详细定义如下：</p>
<figure class="highlight plaintext"><figcaption><span>os_tTask.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">/*任务结构体*/</span><br><span class="line">typedef struct _tTask</span><br><span class="line">&#123;</span><br><span class="line">	/*&lt;!指向堆栈指针*/</span><br><span class="line">	tTaskStack *stack;						</span><br><span class="line">	char taskname[OS_TASKNAME_LENGTH];		/*&lt;!任务的名字*/	</span><br><span class="line">	uint8_t taskname_length;				/*&lt;!任务名字长度*/</span><br><span class="line">/*&lt;!任务队列，当前保留，暂时没使用，使用方法是将所有任务链接在一起*/</span><br><span class="line">	tNode tasknode;							</span><br><span class="line">/*&lt;!任务ID号，为每个任务分配一个ID号，当前保留，暂时没有使用*/</span><br><span class="line">	uint32_t taskID;						</span><br><span class="line">/*&lt;!优先级队列链表节点,放在就绪表中*/</span><br><span class="line">	tNode linkNode;							</span><br><span class="line">	uint32_t TaskRunTimeslice;				/*&lt;!任务运行的时间片*/</span><br><span class="line">/*&lt;!任务的时间片，保存者当前任务运行多长的时间*/</span><br><span class="line">	uint32_t TaskTimeslice;					</span><br><span class="line">/*&lt;!添加挂起计数器 被挂起的次数(暂停计数器，被暂停运行的次数)*/</span><br><span class="line">	uint32_t suspendCount;					</span><br><span class="line">	uint32_t 	delayTicks;					/*&lt;!任务延时计时器*/	</span><br><span class="line">	tNode delayNode;						/*&lt;!添加延时节点*/</span><br><span class="line">	uint32_t 	prio;						/*&lt;!任务的优先级*/	</span><br><span class="line">/*&lt;!任务状态字段(指示是否处于延时状态)*/</span><br><span class="line">	uint32_t state;							</span><br><span class="line">	uint32_t *stackBase;					/*&lt;!栈的起始地址*/</span><br><span class="line">	uint32_t stacksize;						/*&lt;!任务栈总大小*/</span><br><span class="line">/*&lt;!任务被删除时调用的清理函数*/</span><br><span class="line">	void (*clean)(void * param); 			</span><br><span class="line">	void *cleanParam;            			/*&lt;!传递给清理函数的参数*/</span><br><span class="line">/*&lt;!请求删除标志，非0表示请求删除*/</span><br><span class="line">	uint8_t requestDeleteFlag;   			</span><br><span class="line">	/*&lt;!添加等待的事件控制块类型数据*/</span><br><span class="line">	/*&lt;!因为是指针类型，只要告诉编译器有这么一个类型就可以了，他的大小是指针变量的大小就可以了，</span><br><span class="line">	 *  编译器就知道怎么编译了，指针分配的空间是固定的，4个字节</span><br><span class="line">	 */</span><br><span class="line">	tEvent *waitEvent;</span><br><span class="line">/*&lt;!等待事件控制块，存放消息的地方（邮箱中会使用到）*/</span><br><span class="line">	void *EventMsg;							</span><br><span class="line">	uint32_t waitEventResult;				/*&lt;!等待事件的结果*/</span><br><span class="line">	/*&lt;!保存请求的类型:  置位清零（置位中清零有：任意标志位匹配 、所有标志位匹配）*/</span><br><span class="line">	uint32_t waitFlagsType;				</span><br><span class="line">/*&lt;!请求的事件标志：等待那些标志出现任务就运行*/</span><br><span class="line">	uint32_t eventFlags;					</span><br><span class="line">	/**线程故障信息，实时性要求不高时，可以开启*/</span><br><span class="line">#if(THREAD_FAULT == 1)</span><br><span class="line">	Threadfailure Threadfault;</span><br><span class="line">#endif</span><br><span class="line">	</span><br><span class="line">&#125;tTask;</span><br></pre></td></tr></table></figure>

<p>其中uint32_t 	prio是线程创建时指定的线程优先级，它在线程运行过程中是不会改变的。</p>
<h3 id="1-线程的属性"><a href="#1-线程的属性" class="headerlink" title="1. 线程的属性"></a>1. 线程的属性</h3><h4 id="1-线程栈"><a href="#1-线程栈" class="headerlink" title="1. 线程栈"></a>1. 线程栈</h4><p>GoupOS线程具有独立的栈，当进行线程切换时，会将当前线程的上下文保存在栈中，当线程要恢复运行时，再从栈中读取上下文信息进行恢复。<br>线程栈还用来存放函数中的局部变最：函数中的局部变量从线程栈空间中申请；函数中局部变量初始时从寄存器中分配(ARM架构)，当该函数再调用另一个函数时，这些局部变量将被放入栈中。<br>第一次运行线程时，可以以手工的方式构造上下文来设置一些初始环境：入口函数(PC寄存器）、入口参数(RO寄存器）、返回位置(LR寄存器）、当前机器运行状态(CPSR寄存器）。<br>线程栈的增长方向是与芯片构架密切相关的，目前版本均只支持栈由高地址向低地址增对千ARM Cortex M架构，线程栈的构造如右侧图所示。<br>线程栈大小可以这样设定：对于资源相对较大的MCU,可以设计较大的线程栈；也可以在初始时设置较大的栈。例如指定大小为1KB或2KB,可以根据系统提供的函数获取栈大概的使用率。<br><a><img data-src="https://s2.loli.net/2022/05/07/FtHJYEGkWmQdlbe.png" alt="线程栈的构造.png"></a></p>
<h4 id="2-线程状态"><a href="#2-线程状态" class="headerlink" title="2. 线程状态"></a>2. 线程状态</h4><p>在线程运行过程中，同时间内只允许一个线程在处理器中运行。从运行的过程上划分，线程有多种不同的运行状态，如初始状态、挂起状态、就绪状态等。在GoupOS中，线程包含4种状态，操作系统会自动根据线程运行的情况来动态调整其状态。GoupOS中线程的4种状态如下表所示。<br><img data-src="https://s2.loli.net/2022/05/07/5QsbiJzohYL2UKX.png" alt="线程的4中状态.png"></p>
<h4 id="3-线程优先级"><a href="#3-线程优先级" class="headerlink" title="3. 线程优先级"></a>3. 线程优先级</h4><p>GoupOS线程的优先级表示线程被调度的优先程度。每个线程都具有优先级， 线程越重要，被赋予的优先级就越高，该线程被调度的可能性就越大。<br>GoupOS最大支持32个线程优先级(0~32)，数值越小的优先级越高，0为最高优先级。对于ARM Cortex-M系列，普遍采用32个优先级。最低优先级默认分配给空。最低优先级默认分配给空闲线程使用，用户一般不使用。在系统中， 如果有比当前线程优先级更高的线程就绪时，当前线程将立刻被换出，高优先级线程抢占处理器运行。</p>
<h4 id="4-时间片"><a href="#4-时间片" class="headerlink" title="4. 时间片"></a>4. 时间片</h4><p>每个线程都有时间片参数，但时间片仅对优先级相同的就绪状态线程有效。 当系统对优先级相同的就绪状态线程采用时间片轮转的调度方式进行调度时， 时间片起到约束线程单次运行时长的作用， 其单位是一个系统节拍(OS Tick)。 假设有2个优先级相同的就绪状态线程A与B, A线程的时间片设置为10, B线程的时间片设置为5, 那么当系统中不存在比A优先级高的就绪状态线程时，系统会在A、B线程间来回切换执行，并且每次对A线程执行10个节拍的时长， 对B线程执行5个节拍的时长，如下图所示。<br><img data-src="https://s2.loli.net/2022/05/07/87AzsDPXCj1v6FK.png" alt="相同优先级时间片轮转.png"></p>
<h4 id="5-线程入口函数"><a href="#5-线程入口函数" class="headerlink" title="5. 线程入口函数"></a>5. 线程入口函数</h4><p>线程控制块中的task1Entry是线程的入口函数， 它是线程实现预期功能的函数。线程的入口函数有用户设计实现，一般有一下两种代码模式。<br>(1)无限循环模式：在实时系统中， 线程通常是被动式的。 这是由实时系统的特性所决定的， 实时系统通常总是等待外界事件的发生， 而后进行相应的服务。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">void task1Entry(void *param)</span><br><span class="line">&#123;</span><br><span class="line">	for(;;)</span><br><span class="line">	&#123;</span><br><span class="line">		/*&lt;! User code */	</span><br><span class="line">	&#125;	</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>线程看似没有什么限制程序执行的因素，似乎所有的操作都可以执行。但是作为一个优先级明确的实时系统，如果一个线程中的程序陷入了死循环，那么比它优先级低的线程都将不能得到执行。所以在实时操作系统中必须注意的一点：线程中不能陷入死循环操作，必须要有让出CPU使用权的动作，如在循环中调用延时函数或者主动挂起。用户设计这种无限循环线程的目的，就是为了让该线程一直被系统循环调度运行，永不删除。<br>(2)顺序执行或有限次循环模式：简单的顺序语旬、do while()或for()循环等。</p>
<h4 id="6-线程错误码"><a href="#6-线程错误码" class="headerlink" title="6. 线程错误码"></a>6. 线程错误码</h4><p>一个线程就是一个执行场景，错误码是与执行环境密切相关的，所以为每个线程配备了一个变量，用于保存错误码。线程的错误码有以下几种：</p>
<figure class="highlight plaintext"><figcaption><span>os_tEventConBlock_h__</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * @brief (等待事件的)错误码</span><br><span class="line"> */</span><br><span class="line">typedef enum _tError</span><br><span class="line">&#123;</span><br><span class="line">	tErrorNoError				= 0,			/*&lt;!无错误*/</span><br><span class="line">	tErrorTimeout				= 1,			/*&lt;!任务超时*/</span><br><span class="line">	tErrorResourceUnavaliable 	= 2,          	/*&lt;!错误，资源不可用*/</span><br><span class="line">	tErrorDel 				 	= 3,			/*&lt;!信号量被删除 */</span><br><span class="line">	tErrorResourceFull			= 4,			/*&lt;!错误，资源不可用*/</span><br><span class="line">	tErrorOwner					= 5,			/*&lt;!拥有者错误*/</span><br><span class="line">&#125; tError;</span><br></pre></td></tr></table></figure>

<h3 id="2-线程状态切换"><a href="#2-线程状态切换" class="headerlink" title="2. 线程状态切换"></a>2. 线程状态切换</h3><p>GoupOS提供一系列的操作系统调用接口，使得线程的状态在这几种状态之间来回切换。几种状态之间的转换关系如下图所示。<br><img data-src="https://s2.loli.net/2022/05/07/QmjcC3a9yXdZM5K.png" alt="程状态转换图.png"></p>
<table border="1">
    <caption>线程状态转换的基本函数</caption>
    <tr>
        <td>任务创建函数</td>
        <td>tTaskInit()；</td>
    </tr>
    <tr>
        <td>任务延时函数</td>
        <td>tTaskDelay ()；</td>
    </tr>
    <tr>
        <td>任务挂起函数</td>
        <td>tTaskSuspend();</td>
    </tr>
    <tr>
        <td>任务唤醒函数</td>
        <td>tTaskwakeUp();</td>
    </tr>
    <tr>
        <td>任务等待事件函数</td>
        <td>tEventwait();</td>
    </tr>
    <tr>
        <td>任务获取事件函数</td>
        <td>tEventWakeUp();
            <br>
            tEventWakeUpTask();
        </td>
    </tr>
    <tr>
        <td>任务删除函数</td>
        <td>
            tTaskForceDelete();
            <br>
            tTaskRequestDelete();
            <br>
            tTaskIsRequestedDeleted();
            <br>
            tTaskDeleteSelf();
        </td>
    </tr>
</table>

<p>线程通过调用函数tTaskInit()进入初始状态；初始完成后进入就绪状态；就绪状态的线程被调度器调度后进入运行状态；当处于运行状态的线程调用tTaskDelay()、tSemWait()、tMutexChokeObtainlock()等函数或者获取不到资源时，将进入挂起状态；处于挂起状态 的线程，如果等待超时依然未能获得资源或由千其他线程释放了资源，它将返回到就绪状态。挂起状态的线程．，如果调用tSemDestroy()、tMutexTaskDelete()函数，将更改为关闭状态。<br>注意：GoupOS实际上线程并不存在运行状态，就绪状态和运行状态是等同的。</p>
<h3 id="3-系统线程"><a href="#3-系统线程" class="headerlink" title="3. 系统线程"></a>3. 系统线程</h3><p>前文中已提到，系统线程是指由系统创建的线程，用户线程是由用户程序调用线程管理接口创建的线程，在GoupOS内核中的系统线程有空闪线程和主线程。</p>
<h4 id="1-空闲线程"><a href="#1-空闲线程" class="headerlink" title="1. 空闲线程"></a>1. 空闲线程</h4><p>空闲线程是系统创建的最低优先级的线程，线程状态永远为就绪状态。当系统中无其就绪线程存在时，调度器将调度到空闲线程，它通常是一个死循环，且永远不能被挂起。另外，空闲线程在GoupOS中也有它的特殊用途。<br>空闲线程也提供了接口来运行用户设置的钩子函数在空闲线程运行时会调用该钩子函数，适合钩入功耗管理、看门狗、喂狗等工作。</p>
<h2 id="4-线程的管理方式"><a href="#4-线程的管理方式" class="headerlink" title="4. 线程的管理方式"></a>4. 线程的管理方式</h2><p>程状态转换图描述了线程的相关操作，包括创建／初始化线程、启动线程、运行线程、删除线程。使用<code>tTaskInit()</code>初始化一个静态线程，静态线程由用户分配栈空间。</p>
<h3 id="1-创建和删除线程"><a href="#1-创建和删除线程" class="headerlink" title="1. 创建和删除线程"></a>1. 创建和删除线程</h3><p>线程的初始化可以使用下面的函数接口完成， 它用于初始化线程对象，线程的线程句柄（或者说线程控制块指针）、线程栈由用户提供。线程控制块、线程运行栈一般都设置为全局变量， 在编译时就被确定和被分配处理， 内核不负责分配内存空间。需要注意的是,用户提供的栈首地址需进行系统对齐（例如ARM上需要进行4字节对齐）。线程创建接口的参数和返回值如下表所示。</p>
<figure class="highlight plaintext"><figcaption><span>os_tTask_h__</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void tTaskInit(	char *taskname,  uint16_t taskname_legnth,tTask* task,  void (*entry)(void *),void *param,uint32_t prio,tTaskStack *stack,uint32_t stacksize,uint32_t tTaskRTime);</span><br></pre></td></tr></table></figure>

<table border="1">
    <caption>任务初始化tTaskInit()的输入参数列表s</caption>
    <tr>
        <th>参数</th>
        <th>描述</th>
    </tr>
    <tr>
        <td>taskname</td>
        <td>
            线程的名称；线程名称的最大长度由GoupOSconfig.h中的宏OS_TASKNAME_LENGTH指定，多余部分会被自动截掉
        </td>
    </tr>
    <tr>
        <td>taskname_legnth</td>
        <td>
            任务名称长度，为了保证线程名称安全，当线程名称中有特殊字符时候，通过指定名称长度，保证特殊字符也再保存，超过名字宏OS_TASKNAME_LENGTH指定长度后，多余部分会被自动截断
        </td>
    </tr>
    <tr>
        <td>task</td>
        <td>
            线程对象，每个线程都有一个自己的线程对象管理线程数据(线程旬柄。线程旬柄由用户提供, 指向对应的线程控制块内存地址)
        </td>
    </tr>
    <tr>
        <td>entry</td>
        <td>线程入口函数</td>
    </tr>
    <tr>
        <td>param</td>
        <td>线程入口函数参数</td>
    </tr>
    <tr>
        <td>prio</td>
        <td>
            线程的优先级。优先级范围取决于系统配置情况(GoupOSconfig.h中的TINYOS_PRO_COUNT宏定义），目前支持1024个优先级，可以修改。数值越小优先级越高，0代表最高优先级
        </td>
    </tr>
    <tr>
        <td>stack</td>
        <td>
            线程栈起始地址，该地址为栈底地址；为数组的首地址
        </td>
    </tr>
    <tr>
        <td>stacksize</td>
        <td>
            线程栈大小，单位是系统位宽除以8（单位是字，32位系统中1个字等于4字节）；例如：32位/8则单位为4个字节为一个单位。
        </td>
    </tr>
    <tr>
        <td>tTaskRTime</td>
        <td>
            线程的时间片大小，时间片的单位时操作系统的时钟节拍。当系统中存在相同优先级的线程时，并且没有更高优先级任务，这个参数指定的线程一次调度能够运行的最大时间长度。这个时间片运行结束时，调度器自动选择下一个就绪状态的同优先级线程运行。
        </td>
    </tr>  
</table>

<p>线程通过该函数后，就会直接创建好，并且进入就绪态等待CPU的调用。</p>
<h3 id="2-获取线程信息"><a href="#2-获取线程信息" class="headerlink" title="2. 获取线程信息"></a>2. 获取线程信息</h3><p>在程序运行过程中一段相同的代码可能会被多个线程执行，在执行的时候可以通过下面的函数接口获得当前执行的线程句柄（线程任务）如下表</p>
<figure class="highlight plaintext"><figcaption><span>os_tTask_h__</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">void tTaskGetInfo(tTask* task,tTaskInfo * taskinfo);</span><br><span class="line">void tTaskGetCurrentInfo(tTaskInfo * taskinfo);</span><br></pre></td></tr></table></figure>

<table border="1">
    <caption>任务初始化tTaskInit()的输入参数列表s</caption>
    <tr>
        <th>返回数据</th>
        <th>描述</th>
    </tr>
    <tr>
        <td>tTaskInfo * taskinfo</td>
        <td>
            线程信息结构体
        </td>
    </tr>
</table>

<h3 id="3-线程睡眠"><a href="#3-线程睡眠" class="headerlink" title="3. 线程睡眠"></a>3. 线程睡眠</h3><p>在实际应用中，我们有时需要让当前运行的线程延迟一段时间，即在指定的时间到达后重新运行，这就叫做“线程睡眠”,线程睡眠可以使用以下函数接口</p>
<figure class="highlight plaintext"><figcaption><span>os_tTime.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void  tTaskDelay (uint32_t delay);</span><br></pre></td></tr></table></figure>
<p>调用它们可以使当前线程挂起一段指定的时间，当这个时间过后，线程会被唤醒并再次进入就绪状态。这个函数接受一个参数，该参数指定线程的休眠时间。 线程睡眠接口的参数如下表</p>
<table border="1">
    <caption>任务初始化tTaskInit()的输入参数列表</caption>
    <tr>
        <th>参数</th>
        <th>描述</th>
    </tr>
    <tr>
        <td>delay</td>
        <td>
            线程睡眠的时间，传入的参数睡眠(或延时)时间等于:delay*系统时钟节拍。具体时间，需要知道设置的时钟节拍最短时间是多少，然后乘上延时数。
        </td>
    </tr>
</table>

<h3 id="4-挂起和恢复线程"><a href="#4-挂起和恢复线程" class="headerlink" title="4. 挂起和恢复线程"></a>4. 挂起和恢复线程</h3><p>当线程调用<code>tTaskDelay()</code>时，线程将主动挂起；当调用<code>tMutexChokeObtainlock()、tSemWait()</code>等函数时，资源不可使用也将导致线程挂起。处于挂起状态的线程？如果其等待的资源超时（超过其设定的等待时间），那么该线程将不再等待这些资源，而是返回到就绪状态；而是返回到就绪状态，或者当其他线程释放掉该线程所等待的资源时，该线程也会返回到就绪状态。<br>线程挂起使用下面的函数接口：</p>
<figure class="highlight plaintext"><figcaption><span>os_tTask.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">void tTaskSuspend(tTask * task);</span><br><span class="line">void CurrentTaskSuspend(void);</span><br></pre></td></tr></table></figure>

<p>线程挂起接口的参数和返回值见下表</p>
<table border="1">
    <caption> tTaskSuspend()/CurrentTaskSuspend()的输入参数</caption>
    <tr>
        <th>参数</th>
        <th>描述</th>
    </tr>
    <tr>
        <td>task</td>
        <td>
            线程任务（线程句柄）
        </td>
    </tr>
</table>

<p>注意：通常不应该使用这个函数来挂起线程本身，如果确实需要采用<code>tTaskSuspend()、CurrentTaskSuspend()</code>函数挂起当前任务，需要再调用tTaskwakeUp()函数唤醒任务。用户只需要了解该接口的作用，不推荐使用该接口。<br>恢复线程就是让挂起的线程重新进入就绪状态，并将线程放入系统的就绪队列中；如果被恢复线程在所有就绪状态线程中位于最高优先级链表的第一位，那么系统将进行线程上下文的切换。线程恢复使用下面的函数接口：</p>
<figure class="highlight plaintext"><figcaption><span>os_tTask.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void tTaskwakeUp(tTask *task)</span><br></pre></td></tr></table></figure>

<p>线程恢复接口的参数和返回值见下表</p>
<table border="1">
    <caption>tTaskwakeUp()的输入参数和返回值</caption>
    <tr>
        <th>参数</th>
        <th>描述</th>
    </tr>
    <tr>
        <td>task</td>
        <td>
            线程任务（线程句柄）
        </td>
    </tr>
</table>

<h3 id="5-设置和删除空闲钩子"><a href="#5-设置和删除空闲钩子" class="headerlink" title="5. 设置和删除空闲钩子"></a>5. 设置和删除空闲钩子</h3><p>空闲钩子函数是空闲线程的钩子函数，如果设置了空闲钩子函数，就可以在系统执行空闲线程时自动执行空闲钩子函数来做一些其他事情，比如系统指示灯。设置空闲任务钩子的接口：</p>
<figure class="highlight plaintext"><figcaption><span>os_Hooks.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void Hooksidle(void)</span><br></pre></td></tr></table></figure>

<p>向钩子函数内部添加函数功能。</p>
<h3 id="6-设置调度锁钩子"><a href="#6-设置调度锁钩子" class="headerlink" title="6. 设置调度锁钩子"></a>6. 设置调度锁钩子</h3><p>在整个系统运行时，系统都处于线程运行、中断触发－响应中断、切换到其他线程，甚至是线程间的切换过程中，或者说系统的上下文切换是系统中最普遍的事件。有时用户可能会想知道在某个时刻发生了什么样的线程切换，可以通过调用下面的函数接口设置一个相应的钩子函数。在系统线程切换时，这个钩子函数将被调用：</p>
<figure class="highlight plaintext"><figcaption><span>os_Hooks.h</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void HooksTaskSwitch(tTask * from,tTask * to);</span><br></pre></td></tr></table></figure>

<p>设置调度器钩子函数的输入参数如下表所示。(该部分功能正在完善，此处暂时不要使用)</p>
<table border="1">
    <caption>HooksTaskSwitch()的输入参数和返回值</caption>
    <tr>
        <th>参数</th>
        <th>描述</th>
    </tr>
    <tr>
        <td> </td>
        <td>
        </td>
    </tr>
    <tr>
        <td> </td>
        <td>
        </td>
    </tr>
    <tr>
        <th>返回值</th>
        <th>描述</th>
    </tr>
    <tr>
        <td> </td>
        <td>
        </td>
    </tr>
</table>

<h2 id="5-线程应用示例"><a href="#5-线程应用示例" class="headerlink" title="5. 线程应用示例"></a>5. 线程应用示例</h2><p>下面给出在Keil模拟器环境下的应用示例，所有应用示例均在Keil模拟器环境下运行。</p>
<h3 id="1-创建线程示例"><a href="#1-创建线程示例" class="headerlink" title="1. 创建线程示例"></a>1. 创建线程示例</h3><p>下面的例子创建两个线程，代码示例：</p>
<table border="1">
    <caption>线程创建运行示例</caption>
</table>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;GoupOSinclude.h&quot;   //系统头文件</span><br><span class="line"></span><br><span class="line">tTaskStack task1Env[1024];   /*线程1的栈*/</span><br><span class="line">tTaskStack task2Env[1024];   /*线程2的栈*/</span><br><span class="line"></span><br><span class="line">tTask tTask1; /*线程1句柄*/</span><br><span class="line">tTask tTask2; /*线程2句柄*/</span><br><span class="line"></span><br><span class="line">int i = 0;</span><br><span class="line">int a = 0;</span><br><span class="line"></span><br><span class="line">/*&lt;!线程1*/</span><br><span class="line">void task1Entry(void *param)</span><br><span class="line">&#123;</span><br><span class="line">	 tSemInit(&quot;test&quot;,sizeof(&quot;test&quot;),&amp;sem,0,0);</span><br><span class="line">	for(;;)</span><br><span class="line">	&#123;	</span><br><span class="line">		i ++;</span><br><span class="line">		tTaskDelay(1);</span><br><span class="line">		i ++;</span><br><span class="line">		tTaskDelay(1);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">/*&lt;!线程2*/</span><br><span class="line">void task2Entry(void *param)</span><br><span class="line">&#123;</span><br><span class="line">	for(;;)</span><br><span class="line">	&#123;</span><br><span class="line">		a ++;</span><br><span class="line">		tTaskDelay(1);</span><br><span class="line">		a ++;</span><br><span class="line">		tTaskDelay(1);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*用户任务初始化程序*/</span><br><span class="line">void AppTaskInit(void)</span><br><span class="line">&#123;</span><br><span class="line">	tTaskInit(&quot;task1&quot;,sizeof(&quot;task1&quot;),&amp;tTask1,task1Entry,(void *)0,0,task1Env,1024,10);</span><br><span class="line">	tTaskInit(&quot;task2&quot;,sizeof(&quot;task2&quot;),&amp;tTask2,task2Entry,(void *)0,9,task2Env,1024,4);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">	Goup_os_Init();</span><br><span class="line">	/*&lt;!初始化APP相关配置*/</span><br><span class="line">	AppTaskInit();</span><br><span class="line">	/*&lt;!启动系统*/</span><br><span class="line">	 StartSystem();</span><br><span class="line">	while(1)</span><br><span class="line">	&#123;</span><br><span class="line">	&#125;</span><br><span class="line">//	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://s2.loli.net/2022/05/07/RSVq3NLfI9dB6iT.png" alt="程序运行效果.png"></p>
<h3 id="2-线程时间片轮转调度示例"><a href="#2-线程时间片轮转调度示例" class="headerlink" title="2. 线程时间片轮转调度示例"></a>2. 线程时间片轮转调度示例</h3><p>下面的例子创建两个线程，示例如下，i和a按时间片的增加</p>
<table border="1">
    <caption>线程创建运行示例</caption>
</table>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;GoupOSinclude.h&quot;   //系统头文件</span><br><span class="line"></span><br><span class="line">tTaskStack task1Env[1024];   /*线程1的栈*/</span><br><span class="line">tTaskStack task2Env[1024];   /*线程2的栈*/</span><br><span class="line"></span><br><span class="line">tTask tTask1; /*线程1句柄*/</span><br><span class="line">tTask tTask2; /*线程2句柄*/</span><br><span class="line"></span><br><span class="line">int i = 0;</span><br><span class="line">int a = 0;</span><br><span class="line"></span><br><span class="line">/*&lt;!线程1*/</span><br><span class="line">void task1Entry(void *param)</span><br><span class="line">&#123;</span><br><span class="line">	 tSemInit(&quot;test&quot;,sizeof(&quot;test&quot;),&amp;sem,0,0);</span><br><span class="line">	for(;;)</span><br><span class="line">	&#123;	</span><br><span class="line">		i ++;</span><br><span class="line">		tTaskDelay(1);</span><br><span class="line">		i ++;</span><br><span class="line">		tTaskDelay(1);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">/*&lt;!线程2*/</span><br><span class="line">void task2Entry(void *param)</span><br><span class="line">&#123;</span><br><span class="line">	for(;;)</span><br><span class="line">	&#123;</span><br><span class="line">		a ++;</span><br><span class="line">		tTaskDelay(1);</span><br><span class="line">		a ++;</span><br><span class="line">		tTaskDelay(1);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/*用户任务初始化程序*/</span><br><span class="line">void AppTaskInit(void)</span><br><span class="line">&#123;</span><br><span class="line">	tTaskInit(&quot;task1&quot;,sizeof(&quot;task1&quot;),&amp;tTask1,task1Entry,(void *)0,0,task1Env,1024,10);</span><br><span class="line">	tTaskInit(&quot;task2&quot;,sizeof(&quot;task2&quot;),&amp;tTask2,task2Entry,(void *)0,9,task2Env,1024,4);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">	Goup_os_Init();</span><br><span class="line">	/*&lt;!初始化APP相关配置*/</span><br><span class="line">	AppTaskInit();</span><br><span class="line">	/*&lt;!启动系统*/</span><br><span class="line">	 StartSystem();</span><br><span class="line">	while(1)</span><br><span class="line">	&#123;</span><br><span class="line">	&#125;</span><br><span class="line">//	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://s2.loli.net/2022/05/07/RSVq3NLfI9dB6iT.png" alt="程序运行效果.png"></p>
<h3 id="3-线程调度器钩子示例"><a href="#3-线程调度器钩子示例" class="headerlink" title="3. 线程调度器钩子示例"></a>3. 线程调度器钩子示例</h3><p>在线程进行调度切换时，会执行调度，我们可以通过设置一个调度器钩子，在线程切换时做一些额外的事情，下面的例子是在调度器钩子函数中变量的增加，代码如下所示。</p>
<table border="1">
    <caption>调度器钩子函数使用示例</caption>
</table>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">#include &quot;GoupOSinclude.h&quot;   //系统头文件</span><br><span class="line"></span><br><span class="line">tTaskStack task1Env[1024];   /*线程1的栈*/</span><br><span class="line">tTaskStack task2Env[1024];   /*线程2的栈*/</span><br><span class="line"></span><br><span class="line">tTask tTask1; /*线程1句柄*/</span><br><span class="line">tTask tTask2; /*线程2句柄*/</span><br><span class="line"></span><br><span class="line">int i = 0;</span><br><span class="line">int a = 0;</span><br><span class="line"></span><br><span class="line">/*&lt;!线程1*/</span><br><span class="line">void task1Entry(void *param)</span><br><span class="line">&#123;</span><br><span class="line">	 tSemInit(&quot;test&quot;,sizeof(&quot;test&quot;),&amp;sem,0,0);</span><br><span class="line">	for(;;)</span><br><span class="line">	&#123;	</span><br><span class="line">		i ++;</span><br><span class="line">		tTaskDelay(1);</span><br><span class="line">		i ++;</span><br><span class="line">		tTaskDelay(1);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">/*&lt;!线程2*/</span><br><span class="line">void task2Entry(void *param)</span><br><span class="line">&#123;</span><br><span class="line">	for(;;)</span><br><span class="line">	&#123;</span><br><span class="line">		a ++;</span><br><span class="line">		tTaskDelay(1);</span><br><span class="line">		a ++;</span><br><span class="line">		tTaskDelay(1);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * @brief 任务切换的钩子函数</span><br><span class="line"> * 函数只是定义在这里，具体实现需要用户实现</span><br><span class="line"> * @param from 任务结构体</span><br><span class="line"> * @param to </span><br><span class="line"> */</span><br><span class="line">void HooksTaskSwitch(tTask * from,tTask * to)</span><br><span class="line">&#123;</span><br><span class="line">    extern uint32_t hooksSwitch_count;</span><br><span class="line">    hooksSwitch_count++;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/*用户任务初始化程序*/</span><br><span class="line">void AppTaskInit(void)</span><br><span class="line">&#123;</span><br><span class="line">	tTaskInit(&quot;task1&quot;,sizeof(&quot;task1&quot;),&amp;tTask1,task1Entry,(void *)0,0,task1Env,1024,10);</span><br><span class="line">	tTaskInit(&quot;task2&quot;,sizeof(&quot;task2&quot;),&amp;tTask2,task2Entry,(void *)0,9,task2Env,1024,4);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">int main(void)</span><br><span class="line">&#123;</span><br><span class="line">	Goup_os_Init();</span><br><span class="line">	/*&lt;!初始化APP相关配置*/</span><br><span class="line">	AppTaskInit();</span><br><span class="line">	/*&lt;!启动系统*/</span><br><span class="line">	 StartSystem();</span><br><span class="line">	while(1)</span><br><span class="line">	&#123;</span><br><span class="line">	&#125;</span><br><span class="line">//	return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img data-src="https://s2.loli.net/2022/05/07/t42OabQ1oUshM7T.png" alt="调度器钩子函数使用示例.png"></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/GoupOS%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%AE%9E%E6%97%B6%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" rel="tag"><i class="fa fa-tag"></i> GoupOS嵌入式实时操作系统</a>
              <a href="/tags/RTOS/" rel="tag"><i class="fa fa-tag"></i> RTOS</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2022/05/06/GoupOS%E6%96%87%E7%AB%A0/GoupOS%E5%86%85%E6%A0%B8%E5%9F%BA%E7%A1%80/" rel="prev" title="GoupOS内核基础">
                  <i class="fa fa-chevron-left"></i> GoupOS内核基础
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2022/05/07/GoupOS%E6%96%87%E7%AB%A0/GoupOS%E5%B5%8C%E5%85%A5%E5%BC%8F%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E7%A7%BB%E6%A4%8D/" rel="next" title="GoupOS嵌入式操作系统移植">
                  GoupOS嵌入式操作系统移植 <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>





  <div style="text-align:center;color: #ccc;font-size:16px;">-------------本文结束 <i class="fa fa-heart"></i> 感谢阅读-------------</div>



    <div class="comments" id="SOHUCS" sid="b6619f584e9bca9eee9c4595a8097542"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xgm</span>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">25k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">22 分钟</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>本站访客数
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span> 人次
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>本站总访问量
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span> 次
      </span>
    </span>
</div>




    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdn.jsdelivr.net/npm/pdfobject@2.2.7/pdfobject.min.js","integrity":"sha256-ph3Dk89VmuTVXG6x/RDzk53SU9LPdAh1tpv0UvnDZ2I="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdn.jsdelivr.net/npm/mermaid@8.14.0/dist/mermaid.min.js","integrity":"sha256-7wT34TI0pEBeEFoi4z+vhuSddGh6vUTMWdqJ2SDe2jg="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>

  <script src="/js/third-party/fancybox.js"></script>

  <script src="/js/third-party/pace.js"></script>

  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




<script class="next-config" data-name="changyan" type="application/json">{"enable":true,"appid":"cyw3VyumL","appkey":"e9ff69b1f44325f8c6d24a15fdf89113"}</script>
<script src="/js/third-party/comments/changyan.js"></script>

</body>
</html>
